<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36" version="28.0.6">
  <diagram name="交易信号产生" id="UFX_fcOVn3kRIJLmEuX1">
    <mxGraphModel dx="1368" dy="764" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="0HW1WMgGXBD1TG098CHV-1" value="FBTimeSeriesSignal" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="40" width="400" height="40" as="geometry" />
        </mxCell>
        <mxCell id="0HW1WMgGXBD1TG098CHV-2" value="构造函数&lt;div&gt;1.&amp;nbsp;读取配置：&lt;/div&gt;&lt;div&gt;&lt;b&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&amp;lt;frequency&amp;gt;&amp;nbsp;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&amp;lt;close_price_frequency&amp;gt;&amp;nbsp;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&amp;lt;cage_frequency&amp;gt;&lt;br&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&amp;lt;publish_ip&amp;gt;&lt;br&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&amp;lt;publish_port&amp;gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&amp;lt;cc_path&amp;gt;&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2.&amp;nbsp;使用&amp;nbsp;ip&amp;nbsp;port&amp;nbsp;初始化 AnyPublisher any_pub&lt;/div&gt;&lt;div&gt;3.&amp;nbsp;初始化：从 CC-P&amp;nbsp;数据库读取万得数据库的前一天的 adjfactor，到二维数组 adjfactor_past&amp;nbsp;中。&lt;/div&gt;&lt;div&gt;注意：万得中读取的 adj&amp;nbsp;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;是前一天：当天的 adj 只有在收盘后才有，因此盘中只能实时计算！&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="40" y="120" width="560" height="200" as="geometry" />
        </mxCell>
        <mxCell id="0HW1WMgGXBD1TG098CHV-3" value="&lt;div&gt;on_snapshot:&lt;/div&gt;&lt;div&gt;1.&amp;nbsp;当日第一次触发的时候：发送当日股票数量和频率。 - SendStockNum&lt;/div&gt;&lt;div&gt;2.&amp;nbsp;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;该股票当日第一次触发的时候：&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;2.1&amp;nbsp;读取&amp;nbsp;rt_adj_factor&amp;nbsp;中该股票的当天跳价，保存在&amp;nbsp;adjValue&amp;nbsp;中&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;2.2&amp;nbsp;读取&amp;nbsp;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;adjfactor_past&amp;nbsp; 中该股票的前一天跳价，保存在&amp;nbsp;preAdj&amp;nbsp;中&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;2.3&amp;nbsp;读取 PreClose&amp;nbsp;因子数值，保存在&amp;nbsp;preClose&amp;nbsp;中&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;2.4&amp;nbsp;如果&amp;nbsp;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;adjValue 、&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;preAdj 、&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;preClose&amp;nbsp; 有效，则发送跳价消息 -- SendAdjSignal(股票，&lt;/span&gt;preClose&amp;nbsp;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;，&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;adjValue，&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;preAdj&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;注意：当日跳价必须放在第一个 snapshot 以后的原因是，这个要基于第一个快照行情算出来。&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="40" y="360" width="560" height="260" as="geometry" />
        </mxCell>
        <mxCell id="0HW1WMgGXBD1TG098CHV-4" value="SendStockNum&lt;div&gt;1. 构造&amp;nbsp;signal&amp;nbsp;value&amp;nbsp;数据：&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;type&amp;nbsp;设置为 SG_MAX_STOCK_NUM&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;stockNum&amp;nbsp;设置为当日股票数量（Solar传递取得）&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;frequency 设置为配置中 &amp;lt;&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;frequency&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;gt;&amp;nbsp;对应的时点数量（240）&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;2.&amp;nbsp;发布信号&lt;/span&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="680" y="360" width="400" height="110" as="geometry" />
        </mxCell>
        <mxCell id="0HW1WMgGXBD1TG098CHV-5" value="SendAdjSignal&lt;br&gt;&lt;div&gt;1. 构造&amp;nbsp;signal&amp;nbsp;value&amp;nbsp;数据：&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;type&amp;nbsp;设置为 SG_ADJ_NOTIFY&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;adj&amp;nbsp; 设置为&amp;nbsp;当日跳价&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;preAdj 设置为&amp;nbsp;前一日跳价&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;preClose 设置为前一日收盘价&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;stock 设置为股票ID&lt;br&gt;&lt;/div&gt;&lt;div&gt;2.&amp;nbsp;发布信号&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="680" y="485" width="400" height="135" as="geometry" />
        </mxCell>
        <mxCell id="0HW1WMgGXBD1TG098CHV-6" value="&lt;div&gt;on_snapshot:&lt;/div&gt;&lt;div&gt;1.&amp;nbsp;当日第一次触发的时候：发送当日股票数量和频率。 - SendStockNum&lt;/div&gt;&lt;div&gt;2.&amp;nbsp;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;该股票当日第一次触发的时候：&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;2.1&amp;nbsp;读取&amp;nbsp;rt_adj_factor&amp;nbsp;中该股票的当天跳价，保存在&amp;nbsp;adjValue&amp;nbsp;中&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;2.2&amp;nbsp;读取&amp;nbsp;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;adjfactor_past&amp;nbsp; 中该股票的前一天跳价，保存在&amp;nbsp;preAdj&amp;nbsp;中&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;2.3&amp;nbsp;读取 PreClose&amp;nbsp;因子数值，保存在&amp;nbsp;preClose&amp;nbsp;中&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;2.4&amp;nbsp;如果&amp;nbsp;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;adjValue 、&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;preAdj 、&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;preClose&amp;nbsp; 有效，则发送跳价消息 -- SendAdjSignal(股票，&lt;/span&gt;preClose&amp;nbsp;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;，&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;adjValue，&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;preAdj&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;注意：当日跳价必须放在第一个 snapshot 以后的原因是，这个要基于第一个快照行情算出来。&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="40" y="660" width="560" height="260" as="geometry" />
        </mxCell>
        <mxCell id="0HW1WMgGXBD1TG098CHV-7" value="&lt;div&gt;on_trade:&lt;/div&gt;&lt;div&gt;1.&amp;nbsp;如果逐笔成交行情的 cancel_flag_ 是 C，直接返回。&lt;br&gt;&lt;/div&gt;&lt;div&gt;2.&amp;nbsp;根据逐笔成交行情的&amp;nbsp;ext&amp;nbsp;找到当前频率下的对应&amp;nbsp;ti&lt;/div&gt;&lt;div&gt;3.&amp;nbsp;拿到当前股票的&amp;nbsp;index&lt;/div&gt;&lt;div&gt;4.&amp;nbsp;通过因子 Model.low_volatility_reversal_v4&amp;nbsp;获取当前股票的 (ti-1) 买信号&lt;/div&gt;&lt;div&gt;5.&amp;nbsp;通过因子 Event.&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;low_volatility_reversal_sell&amp;nbsp;获取当前股票的 (ti-1) 卖信号&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;6.&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="40" y="960" width="560" height="260" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
